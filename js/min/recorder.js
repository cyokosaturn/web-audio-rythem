var Recorder=function(e,r){var t=this,n=t.config=t._extend({},Recorder.defauts,r);n.context=e};Recorder.prototype={_extend:function(){for(var e=arguments[0],r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)e[n]=t[n]}return e},getStream:function(){var e=this,r=e.config;return new Promise(function(e){r.stream?e(r.stream):navigator.getUserMedia({video:!1,audio:!0},function(r){e(r)},function(e){console.log(e.name?e.name:e)})})},recording:function(){var e=this,r=e.config;e.getStream().then(function(e){r.stream=e,r.audioBufferArray=[];var t=r.context.createMediaStreamSource(r.stream),n=r.context.createAnalyser();r.scriptProcessor=r.context.createScriptProcessor(r.bufferSize,1,1),r.scriptProcessor.onaudioprocess=function(e){var t=function(){var e=0,r=new Uint8Array(n.frequencyBinCount);n.getByteFrequencyData(r);for(var t=0;t<r.length;t++)e+=r[t];return e},o=function(){for(var t=e.inputBuffer.getChannelData(0),n=new Float32Array(r.bufferSize),o=0;o<r.bufferSize;o++)n[o]=t[o];r.audioBufferArray.push(n)};t()>=r.detectionMinVolume&&o()},t.connect(n),n.connect(r.scriptProcessor),r.scriptProcessor.connect(r.context.destination)})},stopRecording:function(){var e=this,r=e.config;!r.scriptProcessor||r.scriptProcessor.disconnect(),r.stream&&(r.stream.stop(),r.stream=null)},convertToAudioBuffer:function(e){for(var r=this,t=r.config,n=t.context.createBuffer(1,e.length*t.bufferSize,t.context.sampleRate),o=n.getChannelData(0),c=0;c<e.length;c++)for(var i=0;i<t.bufferSize;i++)o[c*t.bufferSize+i]=e[c][i];return n},getAudioBuffer:function(){var e=this,r=e.config;return e.convertToAudioBuffer(r.audioBufferArray)}},Recorder.defauts={bufferSize:4096,detectionMinVolume:1e4};