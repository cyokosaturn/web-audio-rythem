var Audio=function(o,e){var n=this,t=n.config=n._extend({},Audio.defauts,e);t.context=o,t.gain=t.context.createGain(),t.convolver=t.context.createConvolver(),t.gain.connect(t.convolver),t.convolver.connect(t.context.destination),n.setParam()};Audio.prototype={_extend:function(){for(var o=arguments[0],e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)o[t]=n[t]}return o},setParam:function(o){var e=this.config.effectSoundId,n=this,t=n.config=n._extend(n.config,o||{});t.audioBuffers&&t.effectSoundId!=e&&(t.convolver.buffer=t.audioBuffers[t.effectSoundId])},chancelPlaySchedule:function(){var o=this,e=o.config;e.loop=e.loop-e.preScheduleLoop,e.bufferSources.forEach(function(o){o.loop>=e.loop&&o.bufferSource.stop()})},playScore:function(){var o=this,e=o.config,n=e.context.currentTime;e.loop=0,e.isPlaying=!0,e.bufferSources=[];var t=function(){for(var o=0;o<e.beat;o++)e.score.forEach(function(t){if(t.pattern[o]){var r=e.context.createBufferSource();r.buffer=e.audioBuffers[t.soundId],r.connect(e.gain),r.start(.1+n+(o+e.loop*e.beat)/4*(60/e.tempo)),e.bufferSources.push({loop:e.loop,bufferSource:r}),r.onended=function(){e.bufferSources.shift()}}});e.loop++,console.log(e.bufferSources.length,e.loop)},r=function(){e.timer=setTimeout(function(){e.context.currentTime-n>=(e.loop-e.preScheduleLoop)*e.beat/4*(60/e.tempo)&&t(),r()},0)};r()},stopScore:function(){var o=this,e=o.config;e.isPlaying&&(e.isPlaying=!1,e.bufferSources.forEach(function(o){o.bufferSource.stop()}),e.bufferSources=[],clearTimeout(e.timer))}},Audio.defauts={preScheduleLoop:3,beat:16,tempo:80,bufferSources:[]};